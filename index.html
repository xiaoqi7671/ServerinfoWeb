<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>载入中...</title>
    <style>
        :root { --bg: #050505; --card: #121212; --primary: #3b82f6; --java: #f97316; --text: #f0f0f0; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        
        /* 隐形管理入口 */
        #admin-trigger { position: fixed; top: 0; left: 0; width: 60px; height: 60px; z-index: 999; cursor: pointer; }
        .bars { opacity: 0; transition: 0.3s; padding: 20px; }
        .bars div { width: 20px; height: 2px; background: #fff; margin: 4px 0; border-radius: 2px; }
        .visible-trigger .bars { opacity: 0.2; } 

        #app { width: 92%; max-width: 440px; background: var(--card); padding: 40px 25px; border-radius: 40px; border: 1px solid #222; text-align: center; display: none; opacity: 0; transition: 0.6s ease; }
        h1 { font-size: 1.8rem; margin-bottom: 10px; font-weight: 800; }
        .desc { color: #666; font-size: 0.9rem; margin-bottom: 30px; }
        
        .card { background: #1a1a1a; border-radius: 28px; padding: 22px; text-align: left; border: 1px solid #282828; margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
        .badge { font-size: 10px; font-weight: 900; border: 1.5px solid currentColor; padding: 2px 10px; border-radius: 10px; text-transform: uppercase; }
        .version-tag { font-size: 11px; color: #444; font-family: monospace; }
        
        .data-box { background: #0c0c0c; padding: 14px 16px; border-radius: 16px; margin-bottom: 10px; border: 1px solid #222; }
        .label { font-size: 9px; color: #444; text-transform: uppercase; margin-bottom: 5px; }
        .val { font-family: monospace; font-size: 1.15rem; color: #fff; word-break: break-all; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        button { border: none; border-radius: 14px; padding: 14px; font-weight: 800; cursor: pointer; transition: 0.2s; font-size: 13px; }
        button:active { transform: scale(0.96); }
        .btn-p { background: var(--primary); color: #fff; }
        .btn-j { background: var(--java); color: #fff; }
        .btn-dark { background: #2a2a2a; color: #aaa; }

        .tag { font-size: 11px; background: #0a0a0a; padding: 5px 14px; border-radius: 20px; color: #444; border: 1px solid #1a1a1a; margin: 0 4px; }
    </style>
</head>
<body>

    <div id="admin-trigger" onclick="location.href='admin.html'">
        <div class="bars"><div></div><div></div><div></div></div>
    </div>

    <div id="app">
        <h1 id="s-name"></h1>
        <p id="s-desc" class="desc"></p>
        <div id="cards-container"></div>
        <div id="s-features" style="display:flex; justify-content:center; flex-wrap:wrap; gap:8px; margin-top:25px;"></div>
    </div>

<script>
    async function init() {
        try {
            // 关键修改：直接请求后端 API 接口，不再读取本地文件或变量
            // 后端逻辑会从 Cloudflare KV 数据库提取实时数据
            const res = await fetch('/api/config'); 
            if (!res.ok) throw new Error("无法从后端获取配置");
            const cfg = await res.json();

            // 1. 设置标题和描述
            document.title = cfg.serverName || "服务器状态";
            document.getElementById('s-name').innerText = cfg.serverName || "我的服务器";
            document.getElementById('s-desc').innerText = cfg.description || "";

            // 2. 管理入口可见性
            if (!cfg.hideAdminVisual) {
                document.getElementById('admin-trigger').classList.add('visible-trigger');
            }

            const container = document.getElementById('cards-container');

            // 3. 渲染 Java 版
            if (cfg.java && cfg.java.ip) {
                const port = (cfg.java.port == "25565" || !cfg.java.port) ? "" : ":" + cfg.java.port;
                container.innerHTML += `
                    <div class="card" style="border-top: 4px solid var(--java)">
                        <div class="card-header">
                            <span class="badge" style="color:var(--java)">Java Edition</span>
                            <span class="version-tag">${cfg.java.version || ''}</span>
                        </div>
                        <div class="data-box">
                            <div class="label">Server Address</div>
                            <div class="val" id="j_full">${cfg.java.ip}${port}</div>
                        </div>
                        <button class="btn-j" style="width:100%" onclick="copy('j_full')">复制地址</button>
                    </div>`;
            }

            // 4. 渲染基岩版 (分段复制)
            if (cfg.bedrock && cfg.bedrock.ip) {
                container.innerHTML += `
                    <div class="card" style="border-top: 4px solid var(--primary)">
                        <div class="card-header">
                            <span class="badge" style="color:var(--primary)">Bedrock Edition</span>
                            <span class="version-tag">${cfg.bedrock.version || ''}</span>
                        </div>
                        <div class="data-box">
                            <div class="label">Server IP</div>
                            <div class="val" id="b_ip">${cfg.bedrock.ip}</div>
                        </div>
                        <div class="data-box">
                            <div class="label">Port</div>
                            <div class="val" id="b_port">${cfg.bedrock.port || '19132'}</div>
                        </div>
                        <div class="btn-grid">
                            <button class="btn-dark" onclick="copy('b_ip')">复制 IP</button>
                            <button class="btn-p" onclick="copy('b_port')">复制端口</button>
                        </div>
                    </div>`;
            }

            // 5. 特色标签
            if (cfg.features) {
                cfg.features.forEach(f => {
                    document.getElementById('s-features').innerHTML += `<span class="tag">${f}</span>`;
                });
            }

            // 显示
            const app = document.getElementById('app');
            app.style.display = 'block';
            setTimeout(() => app.style.opacity = '1', 50);

        } catch (e) {
            console.error(e);
            document.getElementById('s-name').innerText = "数据载入失败";
            document.getElementById('s-desc').innerText = "请确认后端 API 是否配置正确 (Cloudflare KV 绑定)。";
        }
    }

    function copy(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "已复制 ✅";
            setTimeout(() => btn.innerText = originalText, 1000);
        });
    }

    init();
</script>
</body>
</html>
