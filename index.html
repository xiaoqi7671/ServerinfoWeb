<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServerInfoWeb - 极简服务器介绍</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0a0a0a; color: #f3f4f6; }
        .glass-card { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .inner-card { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 md:p-8">

    <div id="app" class="glass-card rounded-[2.5rem] p-8 md:p-12 max-w-4xl w-full shadow-2xl transition-all duration-1000 opacity-0 translate-y-4">
        <header class="text-center mb-10">
            <h1 id="serverName" class="text-4xl md:text-5xl font-black mb-4 bg-clip-text text-transparent bg-gradient-to-br from-white to-gray-500 tracking-tight">
                加载中...
            </h1>
            <p id="description" class="text-gray-400 text-lg max-w-xl mx-auto leading-relaxed"></p>
        </header>

        <div id="card-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="java-card" class="inner-card rounded-3xl p-6 transition-all hover:border-gray-600">
                <div class="flex items-center justify-between mb-6">
                    <span class="px-3 py-1 bg-orange-500/10 text-orange-500 text-xs font-bold rounded-full border border-orange-500/20">JAVA EDITION</span>
                    <span id="j-version" class="text-gray-500 text-xs font-mono"></span>
                </div>
                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 tracking-widest mb-2">服务器地址</p>
                    <p id="j-addr" class="text-xl md:text-2xl font-mono text-white break-all"></p>
                </div>
                <button onclick="copyIP('j-addr')" class="w-full py-3 bg-white text-black hover:bg-gray-200 rounded-2xl text-sm font-bold transition-all active:scale-95">
                    复制地址
                </button>
            </div>

            <div id="bedrock-card" class="inner-card rounded-3xl p-6 transition-all hover:border-gray-600">
                <div class="flex items-center justify-between mb-6">
                    <span class="px-3 py-1 bg-blue-500/10 text-blue-500 text-xs font-bold rounded-full border border-blue-500/20">BEDROCK</span>
                    <span id="b-version" class="text-gray-500 text-xs font-mono"></span>
                </div>
                <div class="mb-6">
                    <p class="text-xs uppercase text-gray-500 tracking-widest mb-2">服务器地址:端口</p>
                    <p id="b-addr" class="text-xl md:text-2xl font-mono text-white break-all"></p>
                </div>
                <button onclick="copyIP('b-addr')" class="w-full py-3 bg-blue-600 text-white hover:bg-blue-500 rounded-2xl text-sm font-bold transition-all active:scale-95">
                    复制地址
                </button>
            </div>
        </div>

        <div id="features" class="mt-12 flex flex-wrap justify-center gap-3"></div>
    </div>

    <script>
        // 配置获取逻辑
        async function getConfig() {
            const placeholder = "__SERVER_CONFIG_JSON__";
            
            // 1. 尝试从环境变量（被 sed 替换后的字符串）获取
            if (placeholder !== "__SERVER_CONFIG_JSON__" && placeholder !== "") {
                try {
                    console.log("使用环境变量配置");
                    return typeof placeholder === 'string' ? JSON.parse(placeholder) : placeholder;
                } catch (e) {
                    console.error("解析环境变量 JSON 失败，回退到文件读取", e);
                }
            }

            // 2. 环境变量不可用，则回退读取本地文件
            console.log("读取本地 config.json");
            const resp = await fetch('config.json');
            if (!resp.ok) throw new Error("无法获取配置文件");
            return await resp.json();
        }

        async function init() {
            try {
                const cfg = await getConfig();

                // 填充标题描述
                document.getElementById('serverName').innerText = cfg.serverName;
                document.getElementById('description').innerText = cfg.description;

                const jCard = document.getElementById('java-card');
                const bCard = document.getElementById('bedrock-card');
                const container = document.getElementById('card-container');

                // 处理 JAVA
                if (cfg.java) {
                    const addr = cfg.java.ip + (cfg.java.port === "25565" || !cfg.java.port ? "" : ":" + cfg.java.port);
                    document.getElementById('j-addr').innerText = addr;
                    document.getElementById('j-version').innerText = cfg.java.version;
                } else {
                    jCard.remove();
                }

                // 处理 Bedrock
                if (cfg.bedrock) {
                    const addr = `${cfg.bedrock.ip}:${cfg.bedrock.port}`;
                    document.getElementById('b-addr').innerText = addr;
                    document.getElementById('b-version').innerText = cfg.bedrock.version;
                } else {
                    bCard.remove();
                }

                // 自动居中逻辑：如果只剩下一个卡片
                if (!cfg.java || !cfg.bedrock) {
                    container.classList.replace('md:grid-cols-2', 'md:grid-cols-1');
                    container.classList.add('max-w-md', 'mx-auto');
                }

                // 标签渲染
                const featDiv = document.getElementById('features');
                featDiv.innerHTML = ''; // 清空占位
                if (cfg.features && Array.isArray(cfg.features)) {
                    cfg.features.forEach(f => {
                        const span = document.createElement('span');
                        span.className = "px-4 py-1.5 rounded-full border border-gray-800 text-gray-500 text-xs hover:border-gray-600 transition-colors";
                        span.innerText = f;
                        featDiv.appendChild(span);
                    });
                }

                // 显示动画
                const app = document.getElementById('app');
                app.classList.remove('opacity-0', 'translate-y-4');
                app.classList.add('opacity-100', 'translate-y-0');

            } catch (err) {
                document.getElementById('serverName').innerText = "配置加载失败";
                document.getElementById('description').innerText = "请检查环境变量或 config.json 是否正确";
                console.error(err);
            }
        }

        function copyIP(id) {
            const el = document.getElementById(id);
            if (!el) return;
            const text = el.innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("已成功复制到剪贴板！");
            }).catch(() => {
                alert("复制失败，请手动输入");
            });
        }

        init();
    </script>
</body>
</html>
