<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>载入中...</title>
    <style>
        :root { --bg: #0a0a0a; --card: #161616; --primary: #3b82f6; --text: #eee; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        
        /* 容器初始隐藏，通过 JS 激活 */
        #app { 
            width: 90%; max-width: 500px; background: var(--card); padding: 30px; 
            border-radius: 30px; border: 1px solid #333; text-align: center; 
            display: none; opacity: 0; transition: opacity 0.5s ease; 
        }

        h1 { font-size: 2rem; margin-bottom: 10px; font-weight: 800; }
        .desc { color: #888; font-size: 0.95rem; line-height: 1.5; margin-bottom: 20px; }
        
        .card { background: #222; border-radius: 20px; padding: 20px; text-align: left; border: 1px solid #444; margin-top: 20px; position: relative; overflow: hidden; }
        .badge { color: var(--primary); font-size: 11px; font-weight: bold; border: 1px solid var(--primary); padding: 2px 8px; border-radius: 10px; text-transform: uppercase; }
        .addr { font-family: monospace; font-size: 1.4rem; margin: 15px 0; word-break: break-all; color: #fff; }
        
        button { 
            width: 100%; padding: 12px; background: var(--primary); color: white; 
            border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; 
        }
        button:active { transform: scale(0.98); opacity: 0.9; }

        .tags { display: flex; gap: 8px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .tag { font-size: 12px; background: #333; padding: 5px 12px; border-radius: 20px; color: #aaa; border: 1px solid #444; }
    </style>
</head>
<body>

<div id="app">
    <h1 id="name"></h1>
    <p id="desc" class="desc"></p>
    
    <div id="cards"></div>
    
    <div id="tags" class="tags"></div>
</div>

<script>
    async function start() {
        const app = document.getElementById('app');
        const placeholder = "__SERVER_CONFIG_JSON__";
        let cfg = null;

        try {
            // --- 步骤 1: 获取配置 ---
            if (placeholder !== "__SERVER_CONFIG_JSON__" && placeholder.trim() !== "") {
                cfg = typeof placeholder === 'string' ? JSON.parse(placeholder) : placeholder;
            } else {
                const res = await fetch('config.json');
                if (!res.ok) throw new Error("Config not found");
                cfg = await res.json();
            }

            // --- 步骤 2: 动态更新所有标题 ---
            const sName = cfg.serverName || "我的服务器";
            document.title = sName; // 更新浏览器标签页标题
            document.getElementById('name').innerText = sName; // 更新页面大标题
            document.getElementById('desc').innerText = cfg.description || "";

            // --- 步骤 3: 渲染卡片 ---
            const cardsContainer = document.getElementById('cards');
            
            // Java 版判断 (如果 java 为 null 或 ip 为空则不渲染)
            if (cfg.java && cfg.java.ip) {
                const port = (cfg.java.port == "25565" || !cfg.java.port) ? "" : ":" + cfg.java.port;
                addCard(cardsContainer, "Java Edition", cfg.java.ip + port, "#f97316");
            }

            // Bedrock 版判断
            if (cfg.bedrock && cfg.bedrock.ip) {
                const port = ":" + (cfg.bedrock.port || "19132");
                addCard(cardsContainer, "Bedrock Edition", cfg.bedrock.ip + port, "#3b82f6");
            }

            // --- 步骤 4: 渲染特色标签 ---
            if (cfg.features && Array.isArray(cfg.features)) {
                const tagsContainer = document.getElementById('tags');
                cfg.features.forEach(f => {
                    const span = document.createElement('span');
                    span.className = 'tag';
                    span.innerText = f;
                    tagsContainer.appendChild(span);
                });
            }

        } catch (err) {
            console.error("Initialization error:", err);
            document.getElementById('name').innerText = "载入失败";
            document.getElementById('desc').innerText = "请检查配置文件格式或网络连接";
        } finally {
            // --- 步骤 5: 最终显示容器 ---
            app.style.display = 'block';
            // 使用 requestAnimationFrame 确保 display:block 渲染后再执行动画
            requestAnimationFrame(() => {
                app.style.opacity = '1';
            });
        }
    }

    // 辅助函数：生成卡片
    function addCard(container, type, addr, color) {
        const cardId = 'addr_' + Math.random().toString(36).substr(2, 9);
        const cardHtml = `
            <div class="card" style="border-top: 3px solid ${color}">
                <span class="badge" style="color:${color}; border-color:${color}55">${type}</span>
                <div class="addr" id="${cardId}">${addr}</div>
                <button onclick="copy('${cardId}')" style="background:${color}">复制地址</button>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', cardHtml);
    }

    // 复制功能
    function copy(id) {
        const text = document.getElementById(id).innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert("地址已成功复制！");
        }).catch(err => {
            console.error('Copy failed', err);
        });
    }

    // 启动
    window.onload = start;
</script>
</body>
</html>
